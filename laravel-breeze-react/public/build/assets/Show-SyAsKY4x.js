import{j as e,K as T,r as a,L as E,$ as o,d as f}from"./app-W6sqJIB5.js";import{S as $,N as D,P as F,a as P,F as B,b as H}from"./index-CJ8pWS5t.js";import{C as V,a as G}from"./ckeditor-DInh-xYw.js";import{d as K}from"./index-BejJxnje.js";import"./iconBase-DQczL_4i.js";function M({images:t}){return t!=null&&t.length?e.jsx($,{modules:[D,F],navigation:!0,pagination:{clickable:!0},scrollbar:{draggable:!0},spaceBetween:16,breakpoints:{640:{slidesPerView:1},768:{slidesPerView:1},1024:{slidesPerView:1},1920:{slidesPerView:1}},className:"mb-12",children:t.map((r,n)=>e.jsx(P,{children:e.jsx("div",{className:"overflow-hidden rounded-lg shadow-lg",children:e.jsx("img",{src:`/${r.image_path}`,alt:`Image ${n+1}`,className:"w-full h-60 object-cover transition-transform hover:scale-105"})})},n))}):null}function J(){const{post:t,auth:r,hasCommented:n,created_at:R,isLiked:N,likesCount:y}=T().props,[w,S]=a.useState(N),[v,k]=a.useState(y),[_,d]=a.useState(!1),[m,L]=a.useState(""),[x,u]=a.useState({}),[h,g]=a.useState(!1),[p,j]=a.useState(()=>{try{return sessionStorage.getItem(`commented_${t.id}`)==="true"}catch{return!1}}),[c,b]=a.useState(""),C=async s=>{var i;s.preventDefault(),g(!0),u({});try{await f.post(route("posts.comments.store",t.id),{content:m}),sessionStorage.setItem(`commented_${t.id}`,"true"),j(!0),b("Your comment has been sent for moderation.")}catch(l){((i=l.response)==null?void 0:i.status)===422?u(l.response.data.errors||{}):(console.error(l),alert("Error sending comment"))}finally{g(!1)}};a.useEffect(()=>{n&&(sessionStorage.removeItem(`commented_${t.id}`),j(!1),b(""))},[n,t.id]);const I=async()=>{if(!r.user)return Inertia.visit("/login");d(!0);try{const{data:s}=await f.post(route("posts.like",t.id));S(s.action==="liked"),k(s.likes_count)}catch(s){console.error(s)}finally{d(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(E,{title:t.title}),e.jsxs("div",{className:"container mx-auto flex justify-center space-x-8 bg-black py-4",children:[e.jsx(o,{href:"/blog",className:"px-4 py-2 text-gray-300 hover:text-white transition",children:"Blog List"}),e.jsx(o,{href:"/registration",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Get Ticket"}),r.user&&e.jsx(o,{href:route("logout"),method:"post",as:"button",className:"px-4 py-2 text-white hover:text-red-800 transition",children:"Logout"})]}),e.jsxs("div",{className:"container mx-auto px-6 mt-8 py-8 max-w-3xl",children:[e.jsx("h1",{className:"text-4xl font-extrabold mb-6",children:t.title}),e.jsxs("div",{className:"mt-2 mb-8 flex items-center text-xl text-gray-500",children:[e.jsx(B,{className:"mr-1"}),new Date(t.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})]}),e.jsx(M,{images:t.images}),e.jsx("article",{className:"prose prose-lg prose-gray text-justify mb-4",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:t.description||""}})}),e.jsx("div",{className:"flex justify-start mb-10 ",children:e.jsxs("button",{onClick:I,disabled:_,className:"flex items-center space-x-1 text-2xl focus:outline-none",children:[w?e.jsx(K,{className:"text-red-500"}):e.jsx(H,{}),e.jsx("span",{children:v})]})}),e.jsxs("section",{className:"space-y-8",children:[e.jsx("h2",{className:"text-2xl font-semibold border-b pb-2 mb-4",children:"Comments"}),c&&e.jsx("div",{className:"bg-green-100 p-4 rounded text-green-800",children:c}),t.comments.length>0?e.jsx("ul",{className:"space-y-6",children:t.comments.map(s=>{var l;const i=new Intl.DateTimeFormat("ru-RU",{dateStyle:"long",timeStyle:"short"}).format(new Date(s.created_at));return e.jsxs("li",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-start mb-2",children:[e.jsx("span",{className:"w-10 h-10 bg-gray-200 rounded-full mr-3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:((l=s.user)==null?void 0:l.name)||"Пользователь"}),e.jsx("time",{dateTime:s.created_at,className:"text-sm text-gray-500",children:i})]})]}),e.jsx("div",{className:"text-gray-700 whitespace-pre-line",dangerouslySetInnerHTML:{__html:s.content}})]},s.id)})}):!c&&e.jsx("p",{className:"text-gray-600",children:"There are no comments yet."}),!r.user&&e.jsxs("p",{className:"text-gray-600",children:["To comment you need"," ",e.jsx(o,{href:"/login",className:"text-blue-600 hover:underline",children:"Login"})," ","or"," ",e.jsx(o,{href:"/register",className:"text-blue-600 hover:underline",children:"register"}),"."]}),r.user&&(n||p)&&e.jsx("p",{className:"text-gray-800",children:c||"You have already left a comment"}),r.user&&!n&&!p&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h3",{className:"text-xl mb-4",children:"Leave a comment"}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx(V,{editor:G,data:m,onChange:(s,i)=>L(i.getData())}),x.content&&e.jsx("p",{className:"text-red-600",children:x.content.join(" ")}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:h,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 disabled:opacity-50",children:h?"Sending...":"Send"})})]})]})]}),e.jsx("div",{className:"mt-8",children:e.jsx(o,{href:"/blog",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Back to list"})})]})]})}export{J as default};
