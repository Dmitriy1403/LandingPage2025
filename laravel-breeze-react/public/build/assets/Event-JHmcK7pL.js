import{K as V,r as m,d as p,m as x,j as e,$ as W}from"./app-2kuM716s.js";import{T as X,a as Y,b as ee,c as te}from"./react-tabs-Cv5FCmpF.js";import{b as se,c as ae}from"./index-Cm4C6gth.js";import{d as S}from"./index-CvpIeCHm.js";import{C as le,a as re}from"./ckeditor-BV2_7pxx.js";import"./clsx-B-dksMZM.js";import"./iconBase-CCh4Pcpu.js";function pe(){const{event_days:n,flash:u}=V().props,[f,I]=m.useState([]),[j,T]=m.useState(null),[y,F]=m.useState(null);m.useEffect(()=>{p.get(route("events.getSpeakers")).then(t=>I(t.data)).catch(t=>console.error("Error fetching speakers:",t))},[]);const{data:N,setData:v,post:L,reset:P}=x({title:"",event_date:""}),U=t=>{t.preventDefault(),L(route("events.storeDay"),{onSuccess:()=>P()})},{data:o,setData:d,post:R,reset:$}=x({event_day_id:"",title:"",description:"",start_time:"",end_time:"",location:"",image:null,speakers:[]}),O=t=>{t.preventDefault(),R(route("events.storeSchedule"),{onSuccess:()=>$()})},[w,h]=m.useState(null),{data:_,setData:b,put:A,reset:D}=x({title:"",event_date:""}),M=t=>{h(t.id),b({title:t.title,event_date:t.event_date})},K=t=>{t.preventDefault(),A(route("events.updateDay",w),{onSuccess:()=>{h(null),D()}})},Z=()=>{h(null),D()},[E,g]=m.useState(null),{data:r,setData:i,reset:k}=x({title:"",description:"",start_time:"",end_time:"",location:"",image:null,speakers:[]}),B=t=>{g(t.id),i({title:t.title,description:t.description||"",start_time:t.start_time,end_time:t.end_time,location:t.location,image:null,speakers:t.speakers?t.speakers.map(s=>s.id):[]}),console.log(t)},H=t=>{t.preventDefault();const s=new FormData;s.append("title",r.title||""),s.append("description",r.description||""),s.append("start_time",r.start_time||""),s.append("end_time",r.end_time||""),s.append("location",r.location||""),r.image&&s.append("image",r.image),r.speakers&&r.speakers.length>0&&r.speakers.forEach((a,l)=>{s.append(`speakers[${l}]`,a)}),s.append("_method","PUT"),console.log("FormData entries:");for(let a of s.entries())console.log(a[0]+": "+a[1]);S.Inertia.post(route("events.updateSchedule",E),s,{onSuccess:()=>{g(null),k(),S.Inertia.reload()},onError:a=>console.log("Ошибки:",a)})},Q=()=>{g(null),k()},q=t=>{confirm("Точно удалить это событие?")&&p.delete(route("events.destroySchedule",t)).then(()=>location.reload()).catch(s=>console.error("Error deleting event:",s))},z=t=>{confirm("Вы уверены, что хотите удалить этот день?")&&p.delete(route("events.deleteDay",t)).then(()=>location.reload()).catch(s=>{console.error("Error deleting day",s),alert("Произошла ошибка при удалении дня")})},G=()=>{confirm("Вы уверены, что хотите удалить ВСЁ расписание и все дни?")&&p.delete(route("events.destroyAll")).then(()=>location.reload()).catch(t=>{console.error("Error deleting all:",t),alert("Произошла ошибка при удалении всех данных.")})},C=t=>{if(!t)return"";const s=new Date(`1970-01-01T${t}Z`);return new Intl.DateTimeFormat("ru-RU",{timeZone:"UTC",hour:"2-digit",minute:"2-digit",hour12:!1}).format(s)};return e.jsxs("section",{className:"container mx-auto px-6 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Редактор расписания"}),(u==null?void 0:u.success)&&e.jsx("div",{className:"bg-green-100 text-green-700 py-2 px-4 mb-4 rounded",children:u.success}),e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row md:space-x-8",children:[e.jsxs("form",{onSubmit:U,className:"bg-white p-6 rounded shadow flex-1 mb-4 md:mb-0",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Добавить новый день"}),e.jsx("input",{type:"text",placeholder:"Название дня",value:N.title,onChange:t=>v("title",t.target.value),className:"w-full px-4 py-2 border rounded mb-4"}),e.jsx("input",{type:"date",value:N.event_date,onChange:t=>v("event_date",t.target.value),className:"w-full px-4 py-2 border rounded mb-4"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Добавить день"})]}),e.jsxs("form",{onSubmit:O,className:"bg-white p-6 rounded shadow flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Добавить мероприятие"}),e.jsxs("select",{value:o.event_day_id,onChange:t=>d("event_day_id",t.target.value),className:"w-full px-4 py-2 border rounded mb-4",children:[e.jsx("option",{value:"",children:"Выберите день"}),n==null?void 0:n.map(t=>e.jsxs("option",{value:t.id,children:[t.title," — ",t.event_date]},t.id))]}),e.jsx("input",{type:"text",placeholder:"Название мероприятия",value:o.title,onChange:t=>d("title",t.target.value),className:"w-full px-4 py-2 border rounded mb-4"}),e.jsx("input",{type:"time",value:o.start_time,onChange:t=>d("start_time",t.target.value),className:"w-full px-4 py-2 border rounded mb-4"}),e.jsx("input",{type:"time",value:o.end_time,onChange:t=>d("end_time",t.target.value),className:"w-full px-4 py-2 border rounded mb-4"}),e.jsx("input",{type:"file",onChange:t=>{const s=t.target.files[0];d("image",s),T(s?URL.createObjectURL(s):null)},className:"w-full px-4 py-2 border rounded mb-4"}),j&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Превью:"}),e.jsx("img",{src:j,alt:"Preview",className:"w-40 h-40 object-cover rounded-md border"})]}),e.jsx("input",{type:"text",placeholder:"Место проведения",value:o.location,onChange:t=>d("location",t.target.value),className:"w-full px-4 py-2 border rounded mb-4"}),e.jsx("textarea",{placeholder:"Описание мероприятия",value:o.description,onChange:t=>d("description",t.target.value),className:"w-full px-4 py-2 border rounded mb-4"}),e.jsx("label",{className:"block font-semibold mb-2",children:"Выберите спикеров"}),e.jsx("select",{multiple:!0,value:o.speakers,onChange:t=>d("speakers",[...t.target.selectedOptions].map(s=>s.value)),className:"w-full px-4 py-2 border rounded mb-4",children:f.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.title,")"]},t.id))}),e.jsx("button",{className:"bg-green-600 text-white px-4 py-2 rounded",children:"Добавить мероприятие"})]})]}),e.jsx("div",{className:"mb-8",children:e.jsx("button",{onClick:G,className:"bg-red-600 text-white px-4 py-2 rounded",children:"Удалить все дни и мероприятия"})}),(n==null?void 0:n.length)>0?e.jsxs(X,{children:[e.jsx(Y,{className:"flex justify-center space-x-4 border-b pb-4",children:n.map((t,s)=>e.jsx(ee,{className:({selected:a})=>`px-6 py-2 border rounded-lg cursor-pointer transition ${a?"bg-custom-gradient text-white":"bg-gray-200 hover:bg-gray-300"}`,children:e.jsxs("div",{className:"text-center ",children:[e.jsxs("p",{className:"font-semibold",children:["День ",s+1]}),e.jsx("p",{className:"text-sm",children:t.event_date})]})},t.id))}),n.map(t=>{var s;return e.jsxs(te,{className:"mt-8 ",children:[e.jsx("div",{className:"flex items-center justify-between mb-12 border-8",children:w===t.id?e.jsxs("form",{onSubmit:K,className:"flex space-x-4 items-center",children:[e.jsx("input",{type:"text",value:_.title,onChange:a=>b("title",a.target.value),className:"px-4 py-2 border rounded"}),e.jsx("input",{type:"date",value:_.event_date,onChange:a=>b("event_date",a.target.value),className:"px-4 py-2 border rounded"}),e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded",children:"Сохранить"}),e.jsx("button",{type:"button",onClick:Z,className:"bg-gray-400 text-white px-3 py-1 rounded",children:"Отмена"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800",children:[t.title," — ",t.event_date]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>M(t),className:"bg-yellow-500 text-white px-3 py-1   rounded",children:"Редактировать день"}),e.jsx("button",{onClick:()=>z(t.id),className:"bg-red-600 text-white px-1 py-1  rounded ",children:"Удалить день"})]})]})}),((s=t.schedules)==null?void 0:s.length)>0?t.schedules.map(a=>e.jsx("div",{className:"bg-white shadow-md rounded-lg p-6 mb-6 flex flex-col md:flex-row items-center",children:E===a.id?e.jsxs("form",{onSubmit:H,className:"w-full",encType:"multipart/form-data",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center mb-4 space-y-4 md:space-y-0 md:space-x-4",children:[e.jsx("input",{type:"text",placeholder:"Название мероприятия",value:r.title,onChange:l=>i("title",l.target.value),className:"w-full md:w-1/3 px-4 py-2 border rounded"}),e.jsx("input",{type:"time",value:r.start_time,onChange:l=>i("start_time",l.target.value),className:"w-full md:w-1/5 px-4 py-2 border rounded"}),e.jsx("input",{type:"time",value:r.end_time,onChange:l=>i("end_time",l.target.value),className:"w-full md:w-1/5 px-4 py-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"Место проведения",value:r.location,onChange:l=>i("location",l.target.value),className:"w-full md:w-1/4 px-4 py-2 border rounded"}),e.jsx("label",{className:"block font-semibold mb-2",children:"Выберите спикеров"}),e.jsx("select",{multiple:!0,value:r.speakers,onChange:l=>i("speakers",[...l.target.selectedOptions].map(c=>c.value)),className:"w-full px-4 py-2 border rounded mb-4",children:f.map(l=>e.jsxs("option",{value:l.id,children:[l.name," (",l.title,")"]},l.id))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Описание мероприятия"}),e.jsx(le,{editor:re,config:{toolbar:["heading","|","bold","italic","link","|","bulletedList","numberedList","blockQuote"],heading:{options:[{model:"paragraph",title:"Параграф",class:"ck-heading_paragraph"},{model:"heading1",view:"h1",title:"Заголовок 1",class:"ck-heading_heading1"},{model:"heading2",view:"h2",title:"Заголовок 2",class:"ck-heading_heading2"}]}},data:r.description,onChange:(l,c)=>{const J=c.getData();i("description",J)}})]}),e.jsx("input",{type:"file",onChange:l=>{const c=l.target.files[0];i("image",c),F(c?URL.createObjectURL(c):null)},className:"w-full md:w-1/2 px-4 py-2 border rounded mb-4"}),y&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Новое превью:"}),e.jsx("img",{src:y,alt:"Edit Preview",className:"w-40 h-40 object-cover rounded-md border"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"submit",className:"bg-green-600 text-white px-4 py-2 rounded",children:"Сохранить"}),e.jsx("button",{type:"button",onClick:Q,className:"bg-gray-400 text-white px-4 py-2 rounded",children:"Отмена"})]})]}):e.jsxs("div",{className:"w-full flex flex-col md:flex-row items-center",children:[a.image&&e.jsx("div",{className:"w-32 h-32 md:w-40 md:h-40 flex-shrink-0 mb-4 md:mb-0",children:e.jsx("img",{src:`/img/${a.image}`,alt:a.title,className:"w-full h-full object-cover rounded-full"})}),e.jsxs("div",{className:"flex-1 md:ml-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:a.title}),e.jsxs("p",{className:"text-gray-600 flex items-center",children:[e.jsx(se,{className:"mr-2"})," ",C(a.start_time)," - ",C(a.end_time)]}),e.jsxs("p",{className:"text-gray-600 flex items-center",children:[e.jsx(ae,{className:"mr-2"})," ",a.location]}),e.jsx("div",{className:"mt-2",dangerouslySetInnerHTML:{__html:a.description}}),a.speakers&&a.speakers.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Спикеры:"}),e.jsx("ul",{children:a.speakers.map(l=>e.jsxs("li",{className:"text-gray-600",children:[l.name," (",l.title,")"]},l.id))})]})]}),e.jsxs("div",{className:"mt-4 md:mt-0 md:ml-6",children:[e.jsx("button",{onClick:()=>B(a),className:"bg-yellow-500 text-white px-3 py-1 rounded mr-2",children:"Редактировать"}),e.jsx("button",{onClick:()=>q(a.id),className:"bg-red-600 text-white px-3 py-1 rounded",children:"Удалить"})]})]})},a.id)):e.jsx("p",{className:"text-gray-500 text-center",children:"Для этого дня нет мероприятий"})]},t.id)})]}):e.jsx("p",{className:"text-gray-500 text-center",children:"Нет доступных дней"}),e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 mt-8 rounded",children:e.jsx(W,{href:"/dashboard",children:"Back Dashboard"})})]})}export{pe as default};
