import{j as e,K as $,r as a,L as D,$ as o,d as f}from"./app-BI5VVEiV.js";import{S as E,N as F,P,a as T,F as H,b as V}from"./index-BihdUCYx.js";import{C as B,a as G}from"./ckeditor-C3KpsVAo.js";import{d as K}from"./index-DypYwzGT.js";import"./iconBase-CvnAa6Cb.js";function M({images:s}){return s!=null&&s.length?e.jsx(E,{modules:[F,P],navigation:!0,pagination:{clickable:!0},scrollbar:{draggable:!0},spaceBetween:16,breakpoints:{640:{slidesPerView:1},768:{slidesPerView:1},1024:{slidesPerView:1},1920:{slidesPerView:1}},className:"mb-12",children:s.map((r,i)=>e.jsx(T,{children:e.jsx("div",{className:"overflow-hidden rounded-lg shadow-lg",children:e.jsx("img",{src:`/${r.image_path}`,alt:`Image ${i+1}`,className:"w-full h-60 object-cover transition-transform hover:scale-105"})})},i))}):null}function O(){const{post:s,auth:r,hasCommented:i,created_at:R,isLiked:N,likesCount:y}=$().props,[w,S]=a.useState(N),[v,k]=a.useState(y),[_,d]=a.useState(!1),[m,C]=a.useState(""),[x,u]=a.useState({}),[h,g]=a.useState(!1),[p,j]=a.useState(()=>{try{return sessionStorage.getItem(`commented_${s.id}`)==="true"}catch{return!1}}),[c,b]=a.useState(""),L=async t=>{var l;t.preventDefault(),g(!0),u({});try{await f.post(route("posts.comments.store",s.id),{content:m}),sessionStorage.setItem(`commented_${s.id}`,"true"),j(!0),b("Ваш комментарий отправлен на модерацию.")}catch(n){((l=n.response)==null?void 0:l.status)===422?u(n.response.data.errors||{}):(console.error(n),alert("Ошибка при отправке комментария"))}finally{g(!1)}};a.useEffect(()=>{i&&(sessionStorage.removeItem(`commented_${s.id}`),j(!1),b(""))},[i,s.id]);const I=async()=>{if(!r.user)return Inertia.visit("/login");d(!0);try{const{data:t}=await f.post(route("posts.like",s.id));S(t.action==="liked"),k(t.likes_count)}catch(t){console.error(t)}finally{d(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(D,{title:s.title}),e.jsxs("div",{className:"container mx-auto flex justify-center space-x-8 bg-black py-4",children:[e.jsx(o,{href:"/blog",className:"px-4 py-2 text-gray-300 hover:text-white transition",children:"Blog List"}),e.jsx(o,{href:"/registration",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Get Ticket"}),r.user&&e.jsx(o,{href:route("logout"),method:"post",as:"button",className:"px-4 py-2 text-white hover:text-red-800 transition",children:"Logout"})]}),e.jsxs("div",{className:"container mx-auto px-6 mt-8 py-8 max-w-3xl",children:[e.jsx("h1",{className:"text-4xl font-extrabold mb-6",children:s.title}),e.jsxs("div",{className:"mt-2 mb-8 flex items-center text-xl text-gray-500",children:[e.jsx(H,{className:"mr-1"}),new Date(s.created_at).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})]}),e.jsx(M,{images:s.images}),e.jsx("article",{className:"prose prose-lg prose-gray text-justify mb-4",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:s.description||""}})}),e.jsx("div",{className:"flex justify-start mb-10 ",children:e.jsxs("button",{onClick:I,disabled:_,className:"flex items-center space-x-1 text-2xl focus:outline-none",children:[w?e.jsx(K,{className:"text-red-500"}):e.jsx(V,{}),e.jsx("span",{children:v})]})}),e.jsxs("section",{className:"space-y-8",children:[e.jsx("h2",{className:"text-2xl font-semibold border-b pb-2 mb-4",children:"Комментарии"}),c&&e.jsx("div",{className:"bg-green-100 p-4 rounded text-green-800",children:c}),s.comments.length>0?e.jsx("ul",{className:"space-y-6",children:s.comments.map(t=>{var n;const l=new Intl.DateTimeFormat("ru-RU",{dateStyle:"long",timeStyle:"short"}).format(new Date(t.created_at));return e.jsxs("li",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-start mb-2",children:[e.jsx("span",{className:"w-10 h-10 bg-gray-200 rounded-full mr-3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:((n=t.user)==null?void 0:n.name)||"Пользователь"}),e.jsx("time",{dateTime:t.created_at,className:"text-sm text-gray-500",children:l})]})]}),e.jsx("div",{className:"text-gray-700 whitespace-pre-line",dangerouslySetInnerHTML:{__html:t.content}})]},t.id)})}):!c&&e.jsx("p",{className:"text-gray-600",children:"Комментариев пока нет."}),!r.user&&e.jsxs("p",{className:"text-gray-600",children:["Для комментариев нужно"," ",e.jsx(o,{href:"/login",className:"text-blue-600 hover:underline",children:"войти"})," ","или"," ",e.jsx(o,{href:"/register",className:"text-blue-600 hover:underline",children:"зарегистрироваться"}),"."]}),r.user&&(i||p)&&e.jsx("p",{className:"text-gray-800",children:c||"Вы уже оставили комментарий."}),r.user&&!i&&!p&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h3",{className:"text-xl mb-4",children:"Оставить комментарий"}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsx(B,{editor:G,data:m,onChange:(t,l)=>C(l.getData())}),x.content&&e.jsx("p",{className:"text-red-600",children:x.content.join(" ")}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:h,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 disabled:opacity-50",children:h?"Отправка...":"Отправить"})})]})]})]}),e.jsx("div",{className:"mt-8",children:e.jsx(o,{href:"/blog",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Назад к списку"})})]})]})}export{O as default};
