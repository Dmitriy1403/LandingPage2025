import{K as V,r as m,d as p,m as x,j as e,$ as W}from"./app-BoCm3Igx.js";import{T as X,a as Y,b as ee,c as te}from"./react-tabs-DriJBryc.js";import{b as ae,c as se}from"./index-B2tok-y7.js";import{d as S}from"./index-CfcS5fxA.js";import{C as le,a as re}from"./ckeditor-C4qpi7Wf.js";import"./clsx-B-dksMZM.js";import"./iconBase-C6bG7GdK.js";function pe(){const{event_days:d,flash:u}=V().props,[f,I]=m.useState([]),[j,T]=m.useState(null),[y,F]=m.useState(null);m.useEffect(()=>{p.get(route("events.getSpeakers")).then(t=>I(t.data)).catch(t=>console.error("Error fetching speakers:",t))},[]);const{data:v,setData:N,post:A,reset:L}=x({title:"",event_date:""}),P=t=>{t.preventDefault(),A(route("events.storeDay"),{onSuccess:()=>L()})},{data:o,setData:n,post:U,reset:R}=x({event_day_id:"",title:"",description:"",start_time:"",end_time:"",location:"",image:null,speakers:[]}),$=t=>{t.preventDefault(),U(route("events.storeSchedule"),{onSuccess:()=>R()})},[w,h]=m.useState(null),{data:D,setData:b,put:O,reset:_}=x({title:"",event_date:""}),M=t=>{h(t.id),b({title:t.title,event_date:t.event_date})},K=t=>{t.preventDefault(),O(route("events.updateDay",w),{onSuccess:()=>{h(null),_()}})},Z=()=>{h(null),_()},[E,g]=m.useState(null),{data:r,setData:i,reset:C}=x({title:"",description:"",start_time:"",end_time:"",location:"",image:null,speakers:[]}),B=t=>{g(t.id),i({title:t.title,description:t.description||"",start_time:t.start_time,end_time:t.end_time,location:t.location,image:null,speakers:t.speakers?t.speakers.map(a=>a.id):[]}),console.log(t)},H=t=>{t.preventDefault();const a=new FormData;a.append("title",r.title||""),a.append("description",r.description||""),a.append("start_time",r.start_time||""),a.append("end_time",r.end_time||""),a.append("location",r.location||""),r.image&&a.append("image",r.image),r.speakers&&r.speakers.length>0&&r.speakers.forEach((s,l)=>{a.append(`speakers[${l}]`,s)}),a.append("_method","PUT"),console.log("FormData entries:");for(let s of a.entries())console.log(s[0]+": "+s[1]);S.Inertia.post(route("events.updateSchedule",E),a,{onSuccess:()=>{g(null),C(),S.Inertia.reload()},onError:s=>console.log("Ошибки:",s)})},Q=()=>{g(null),C()},q=t=>{confirm("Точно удалить это событие?")&&p.delete(route("events.destroySchedule",t)).then(()=>location.reload()).catch(a=>console.error("Error deleting event:",a))},z=t=>{confirm("Вы уверены, что хотите удалить этот день?")&&p.delete(route("events.deleteDay",t)).then(()=>location.reload()).catch(a=>{console.error("Error deleting day",a),alert("Произошла ошибка при удалении дня")})},G=()=>{confirm("Вы уверены, что хотите удалить ВСЁ расписание и все дни?")&&p.delete(route("events.destroyAll")).then(()=>location.reload()).catch(t=>{console.error("Error deleting all:",t),alert("Произошла ошибка при удалении всех данных.")})},k=t=>{if(!t)return"";const a=new Date(`1970-01-01T${t}Z`);return new Intl.DateTimeFormat("ru-RU",{timeZone:"UTC",hour:"2-digit",minute:"2-digit",hour12:!1}).format(a)};return e.jsxs("section",{className:"container mx-auto px-6 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Schedule Editor"}),(u==null?void 0:u.success)&&e.jsx("div",{className:"bg-green-100 text-green-700 py-2 px-4 mb-4 rounded",children:u.success}),e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row md:space-x-8",children:[e.jsxs("form",{onSubmit:P,className:"bg-white p-6 rounded shadow flex-1 mb-4 md:mb-0",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Add new day"}),e.jsx("input",{type:"text",placeholder:"Название дня",value:v.title,onChange:t=>N("title",t.target.value),className:"w-full px-4 py-2 border rounded mb-4"}),e.jsx("input",{type:"date",value:v.event_date,onChange:t=>N("event_date",t.target.value),className:"w-full px-4 py-2 border rounded mb-4"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Add day"})]}),e.jsxs("form",{onSubmit:$,className:"bg-white p-6 rounded shadow flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Add event"}),e.jsxs("select",{value:o.event_day_id,onChange:t=>n("event_day_id",t.target.value),className:"w-full px-4 py-2 border rounded mb-4",children:[e.jsx("option",{value:"",children:"Choose day"}),d==null?void 0:d.map(t=>e.jsxs("option",{value:t.id,children:[t.title," — ",t.event_date]},t.id))]}),e.jsx("input",{type:"text",placeholder:"Название мероприятия",value:o.title,onChange:t=>n("title",t.target.value),className:"w-full px-4 py-2 border rounded mb-4"}),e.jsx("input",{type:"time",value:o.start_time,onChange:t=>n("start_time",t.target.value),className:"w-full px-4 py-2 border rounded mb-4"}),e.jsx("input",{type:"time",value:o.end_time,onChange:t=>n("end_time",t.target.value),className:"w-full px-4 py-2 border rounded mb-4"}),e.jsx("input",{type:"file",onChange:t=>{const a=t.target.files[0];n("image",a),T(a?URL.createObjectURL(a):null)},className:"w-full px-4 py-2 border rounded mb-4"}),j&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Preview:"}),e.jsx("img",{src:j,alt:"Preview",className:"w-40 h-40 object-cover rounded-md border"})]}),e.jsx("input",{type:"text",placeholder:"Место проведения",value:o.location,onChange:t=>n("location",t.target.value),className:"w-full px-4 py-2 border rounded mb-4"}),e.jsx("textarea",{placeholder:"Описание мероприятия",value:o.description,onChange:t=>n("description",t.target.value),className:"w-full px-4 py-2 border rounded mb-4"}),e.jsx("label",{className:"block font-semibold mb-2",children:"Choose Speaker"}),e.jsx("select",{multiple:!0,value:o.speakers,onChange:t=>n("speakers",[...t.target.selectedOptions].map(a=>a.value)),className:"w-full px-4 py-2 border rounded mb-4",children:f.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.title,")"]},t.id))}),e.jsx("button",{className:"bg-green-600 text-white px-4 py-2 rounded",children:"Add Event"})]})]}),e.jsx("div",{className:"mb-8",children:e.jsx("button",{onClick:G,className:"bg-red-600 text-white px-4 py-2 rounded",children:"Delete All Days and All Schedules"})}),(d==null?void 0:d.length)>0?e.jsxs(X,{children:[e.jsx(Y,{className:"flex justify-center space-x-4 border-b pb-4",children:d.map((t,a)=>e.jsx(ee,{className:({selected:s})=>`px-6 py-2 border rounded-lg cursor-pointer transition ${s?"bg-custom-gradient text-white":"bg-gray-200 hover:bg-gray-300"}`,children:e.jsxs("div",{className:"text-center ",children:[e.jsxs("p",{className:"font-semibold",children:["День ",a+1]}),e.jsx("p",{className:"text-sm",children:t.event_date})]})},t.id))}),d.map(t=>{var a;return e.jsxs(te,{className:"mt-8 ",children:[e.jsx("div",{className:"flex items-center justify-between mb-12 border-8",children:w===t.id?e.jsxs("form",{onSubmit:K,className:"flex space-x-4 items-center",children:[e.jsx("input",{type:"text",value:D.title,onChange:s=>b("title",s.target.value),className:"px-4 py-2 border rounded"}),e.jsx("input",{type:"date",value:D.event_date,onChange:s=>b("event_date",s.target.value),className:"px-4 py-2 border rounded"}),e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded",children:"Save"}),e.jsx("button",{type:"button",onClick:Z,className:"bg-gray-400 text-white px-3 py-1 rounded",children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800",children:[t.title," — ",t.event_date]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>M(t),className:"bg-yellow-500 text-white px-3 py-1   rounded",children:"Edit day"}),e.jsx("button",{onClick:()=>z(t.id),className:"bg-red-600 text-white px-1 py-1  rounded ",children:"delete day"})]})]})}),((a=t.schedules)==null?void 0:a.length)>0?t.schedules.map(s=>e.jsx("div",{className:"bg-white shadow-md rounded-lg p-6 mb-6 flex flex-col md:flex-row items-center",children:E===s.id?e.jsxs("form",{onSubmit:H,className:"w-full",encType:"multipart/form-data",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center mb-4 space-y-4 md:space-y-0 md:space-x-4",children:[e.jsx("input",{type:"text",placeholder:"Название мероприятия",value:r.title,onChange:l=>i("title",l.target.value),className:"w-full md:w-1/3 px-4 py-2 border rounded"}),e.jsx("input",{type:"time",value:r.start_time,onChange:l=>i("start_time",l.target.value),className:"w-full md:w-1/5 px-4 py-2 border rounded"}),e.jsx("input",{type:"time",value:r.end_time,onChange:l=>i("end_time",l.target.value),className:"w-full md:w-1/5 px-4 py-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"Место проведения",value:r.location,onChange:l=>i("location",l.target.value),className:"w-full md:w-1/4 px-4 py-2 border rounded"}),e.jsx("label",{className:"block font-semibold mb-2",children:"Выберите спикеров"}),e.jsx("select",{multiple:!0,value:r.speakers,onChange:l=>i("speakers",[...l.target.selectedOptions].map(c=>c.value)),className:"w-full px-4 py-2 border rounded mb-4",children:f.map(l=>e.jsxs("option",{value:l.id,children:[l.name," (",l.title,")"]},l.id))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Schedule description"}),e.jsx(le,{editor:re,config:{toolbar:["heading","|","bold","italic","link","|","bulletedList","numberedList","blockQuote"],heading:{options:[{model:"paragraph",title:"Параграф",class:"ck-heading_paragraph"},{model:"heading1",view:"h1",title:"Заголовок 1",class:"ck-heading_heading1"},{model:"heading2",view:"h2",title:"Заголовок 2",class:"ck-heading_heading2"}]}},data:r.description,onChange:(l,c)=>{const J=c.getData();i("description",J)}})]}),e.jsx("input",{type:"file",onChange:l=>{const c=l.target.files[0];i("image",c),F(c?URL.createObjectURL(c):null)},className:"w-full md:w-1/2 px-4 py-2 border rounded mb-4"}),y&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"New preview:"}),e.jsx("img",{src:y,alt:"Edit Preview",className:"w-40 h-40 object-cover rounded-md border"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"submit",className:"bg-green-600 text-white px-4 py-2 rounded",children:"Save"}),e.jsx("button",{type:"button",onClick:Q,className:"bg-gray-400 text-white px-4 py-2 rounded",children:"Cancel"})]})]}):e.jsxs("div",{className:"w-full flex flex-col md:flex-row items-center",children:[s.image&&e.jsx("div",{className:"w-32 h-32 md:w-40 md:h-40 flex-shrink-0 mb-4 md:mb-0",children:e.jsx("img",{src:`/img/${s.image}`,alt:s.title,className:"w-full h-full object-cover rounded-full"})}),e.jsxs("div",{className:"flex-1 md:ml-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:s.title}),e.jsxs("p",{className:"text-gray-600 flex items-center",children:[e.jsx(ae,{className:"mr-2"})," ",k(s.start_time)," - ",k(s.end_time)]}),e.jsxs("p",{className:"text-gray-600 flex items-center",children:[e.jsx(se,{className:"mr-2"})," ",s.location]}),e.jsx("div",{className:"mt-2",dangerouslySetInnerHTML:{__html:s.description}}),s.speakers&&s.speakers.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Speakers:"}),e.jsx("ul",{children:s.speakers.map(l=>e.jsxs("li",{className:"text-gray-600",children:[l.name," (",l.title,")"]},l.id))})]})]}),e.jsxs("div",{className:"mt-4 md:mt-0 md:ml-6",children:[e.jsx("button",{onClick:()=>B(s),className:"bg-yellow-500 text-white px-3 py-1 rounded mr-2",children:"Edit"}),e.jsx("button",{onClick:()=>q(s.id),className:"bg-red-600 text-white px-3 py-1 rounded",children:"Delete"})]})]})},s.id)):e.jsx("p",{className:"text-gray-500 text-center",children:"Don't have schedule for this day"})]},t.id)})]}):e.jsx("p",{className:"text-gray-500 text-center",children:"Don't have abble days"}),e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 mt-8 rounded",children:e.jsx(W,{href:"/dashboard",children:"Back Dashboard"})})]})}export{pe as default};
