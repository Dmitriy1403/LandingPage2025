import{K as D,r as o,j as e,$ as L,d as R}from"./app-W6sqJIB5.js";import{C as U,a as T}from"./ckeditor-DInh-xYw.js";function $(){var g;const{post:a}=D().props,[u,j]=o.useState([]),N=((g=a.images)==null?void 0:g.map(t=>({id:t.id,url:"/"+t.image_path})))||[],[_,w]=o.useState(N),[v,k]=o.useState([]),[i,m]=o.useState({title:a.title||"",description:a.description||"",is_published:a.is_published||!1,published_at:a.published_at?a.published_at.substring(0,16):"",background_image:null,images:[]}),[r,b]=o.useState({}),[h,y]=o.useState(a.background_image?`/${a.background_image}`:null),[x,C]=o.useState(null);o.useEffect(()=>{var t;(t=a.images)!=null&&t.length&&w(a.images.map(s=>({id:s.id,url:"/"+s.image_path})))},[a.images]);const E=t=>{j(s=>s.includes(t)?s.filter(l=>l!==t):[...s,t])},d=t=>{const{name:s,type:l,checked:n,value:S,files:f}=t.target;if(l==="file"){if(s==="background_image"){const c=f[0];C(c),y(c?URL.createObjectURL(c):null)}else if(s==="images"){const c=Array.from(f);m(p=>({...p,images:c})),k(c.map(p=>URL.createObjectURL(p)))}}else m(c=>({...c,[s]:l==="checkbox"?n:S}))},P=async t=>{var l;t.preventDefault(),b({});const s=new FormData;s.append("_token",document.querySelector('meta[name="csrf-token"]').content),s.append("_method","PUT"),s.append("title",i.title),s.append("description",i.description),s.append("is_published",i.is_published),s.append("published_at",i.published_at),x&&s.append("background_image",x),i.images.forEach(n=>s.append("images[]",n)),u.forEach(n=>s.append("delete_images[]",n));try{await R.post(route("posts.update",a.id),s,{headers:{"X-Requested-With":"XMLHttpRequest"}}),window.location.href=route("posts.index")}catch(n){((l=n.response)==null?void 0:l.status)===422?b(n.response.data.errors||{}):(console.error(n),alert("Не удалось обновить пост"))}};return e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-xl",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Edit post"}),e.jsxs("form",{onSubmit:P,encType:"multipart/form-data",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"Background image"}),h?e.jsx("img",{src:h,className:"w-full h-48 object-cover rounded mb-4 border"}):e.jsx("p",{className:"text-gray-500 mb-4",children:"No background image"}),e.jsx("input",{type:"file",name:"background_image",accept:"image/*",onChange:d,className:"w-full"}),r.background_image&&e.jsx("p",{className:"text-red-600 text-sm",children:r.background_image})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[_.map(({id:t,url:s})=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:s,className:"w-32 h-32 object-cover rounded border"}),e.jsx("input",{type:"checkbox",checked:u.includes(t),onChange:()=>E(t),className:"absolute top-1 right-1"})]},t)),v.map((t,s)=>e.jsx("img",{src:t,className:"w-32 h-32 object-cover rounded border"},s))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Title"}),e.jsx("input",{type:"text",name:"title",value:i.title,onChange:d,className:"w-full border rounded px-3 py-2"}),r.title&&e.jsx("p",{className:"text-red-600 text-sm",children:r.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Description"}),e.jsx(U,{editor:T,data:i.description,onChange:(t,s)=>m(l=>({...l,description:s.getData()})),config:{toolbar:["heading","bold","italic","link","bulletedList","numberedList","blockQuote"]}}),r.description&&e.jsx("p",{className:"text-red-600 text-sm",children:r.description})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"is_published",checked:i.is_published,onChange:d,className:"mr-2"}),e.jsx("label",{children:"Publish?"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Date of publication"}),e.jsx("input",{type:"datetime-local",name:"published_at",value:i.published_at,onChange:d,className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Add images"}),e.jsx("input",{type:"file",name:"images",multiple:!0,accept:"image/*",onChange:d,className:"w-full"}),r.images&&e.jsx("p",{className:"text-red-600 text-sm",children:r.images})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(L,{href:"/posts",className:"text-blue-500 hover:underline",children:"Отмена"}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600",children:"Обновить"})]})]})]})}export{$ as default};
